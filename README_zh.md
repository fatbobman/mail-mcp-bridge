# Mail MCP Bridge

> è®© AI ç›´æ¥è®¿é—®ä½ çš„ macOS Mail é‚®ä»¶

**Mail MCP Bridge** æ˜¯ä¸€ä¸ªè¿æ¥ macOS Mail å’Œ AI åŠ©æ‰‹ï¼ˆå¦‚ Claudeã€ChatGPTï¼‰çš„æ¡¥æ¢ã€‚åªéœ€åœ¨ Mail ä¸­å¤åˆ¶ Message-ID å¹¶ç²˜è´´ç»™ AIï¼Œæ— éœ€æ‰‹åŠ¨å¯¼å‡ºé‚®ä»¶ï¼ŒAI å°±èƒ½ç›´æ¥è¯»å–å’Œåˆ†æé‚®ä»¶å†…å®¹ã€‚

## ğŸ¯ ä¸»è¦ç”¨é€”

**æ ¸å¿ƒä»·å€¼ï¼šè®© AI å¸®ä½ åˆ†æçº¯æ–‡æœ¬é‚®ä»¶ï¼Œè·Ÿè¸ªé¡¹ç›®è¿›å±•**

æœ¬é¡¹ç›®ä¸“æ³¨äºæå–å’Œåˆ†æé‚®ä»¶çš„**çº¯æ–‡æœ¬å†…å®¹**ï¼Œéå¸¸é€‚åˆä»¥ä¸‹åœºæ™¯ï¼š

- **ğŸ“‹ é¡¹ç›®è¿›å±•è·Ÿè¸ª** - è®© AI åˆ†æèµåŠ©å•†ã€å®¢æˆ·ã€åˆä½œä¼™ä¼´çš„é‚®ä»¶å¾€æ¥
- **ğŸ’¼ å•†åŠ¡æ²Ÿé€šåˆ†æ** - æå–å…³é”®ä¿¡æ¯ã€è¡ŒåŠ¨é¡¹ã€æ—¶é—´èŠ‚ç‚¹
- **ğŸ” é‚®ä»¶å†…å®¹æ€»ç»“** - å¿«é€Ÿäº†è§£é•¿é‚®ä»¶æˆ–é‚®ä»¶çº¿ç´¢çš„æ ¸å¿ƒå†…å®¹
- **ğŸ“Š æ•°æ®æå–** - ä»é‚®ä»¶ä¸­æå–ç»“æ„åŒ–ä¿¡æ¯ï¼ˆå¦‚éœ€æ±‚ã€åé¦ˆã€æ‰¿è¯ºï¼‰
- **ğŸ¤ å¯¹è¯å†å²å›é¡¾** - å®Œæ•´æŸ¥çœ‹é‚®ä»¶çº¿ç´¢ï¼Œç†è§£æ²Ÿé€šèƒŒæ™¯

**æ³¨æ„ï¼š** æœ¬é¡¹ç›®ä¸“æ³¨äºæ–‡æœ¬å†…å®¹æå–ï¼Œä¸å¤„ç†é™„ä»¶ã€å›¾ç‰‡æˆ– HTML æ ¼å¼åŒ–å†…å®¹ã€‚å¯¹äº AI åˆ†ææ¥è¯´ï¼Œçº¯æ–‡æœ¬æ˜¯æœ€æœ‰æ•ˆçš„è¾“å…¥æ–¹å¼ã€‚

## ğŸ’¡ ä¸ºä»€ä¹ˆåˆ›å»ºè¿™ä¸ªé¡¹ç›®

æˆ‘æœ€è¿‘æ­£åœ¨æ¢ç´¢å°† AI æ·±åº¦èå…¥å·¥ä½œä¸ç”Ÿæ´»çš„å„ä¸ªæ–¹é¢ã€‚åœ¨å®è·µä¸­ï¼Œæˆ‘å‘ç°è®© AI ååŠ©è¿›è¡Œé¡¹ç›®ç®¡ç†å’Œæ²Ÿé€šæ±‡æ€»æ˜¯ä¸€ä¸ªç‰¹åˆ«æœ‰ä»·å€¼çš„åœºæ™¯ã€‚

ç„¶è€Œï¼Œç°å®ä¸­çš„å¾ˆå¤šæ²Ÿé€šéƒ½é€šè¿‡é‚®ä»¶è¿›è¡Œâ€”â€”å°¤å…¶æ˜¯ä¸èµåŠ©å•†ã€å®¢æˆ·ã€åˆä½œä¼™ä¼´çš„å¾€æ¥ã€‚åœ¨ macOS ä¸Šï¼Œè¿™äº›é‚®ä»¶ï¼ˆå°¤å…¶æ˜¯é‚®ä»¶çº¿ç´¢ï¼‰å¯¹åº”çš„æ•°æ®æ–‡ä»¶åˆ†æ•£å­˜å‚¨åœ¨ä¸åŒçš„ç›®å½•ä¸­ã€‚ä¼ ç»Ÿçš„åšæ³•æ˜¯åˆ†åˆ«å¯¼å‡ºæ¯å°é‚®ä»¶æ‰èƒ½è®© AI è·Ÿè¸ªã€åˆ†æï¼Œè¿™å¯¹äºä»åœ¨è¿›è¡Œä¸­çš„é¡¹ç›®æ¥è¯´éå¸¸ä¸å‹å¥½ä¸”æ•ˆç‡ä½ä¸‹ã€‚

ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘åˆ›å»ºäº† **Mail MCP Bridge**ï¼š
- ä¸€é”®è·å–é‚®ä»¶çš„ Message-IDï¼ˆé€šè¿‡ Mail Quick Actionï¼‰
- æä¾›åŸºäº Message-ID çš„ MCP å·¥å…·ï¼Œå¿«é€Ÿæå–ç»“æ„åŒ–çš„çº¯æ–‡æœ¬é‚®ä»¶å†…å®¹
- è®© AI èƒ½å¤Ÿæ— ç¼è·Ÿè¸ªé¡¹ç›®è¿›å±•ã€åˆ†ææ²Ÿé€šå†å²ã€æå–å…³é”®ä¿¡æ¯

ç®€å•æ¥è¯´ï¼Œè¿™ä¸ªé¡¹ç›®å¡«è¡¥äº† macOS Mail å’Œ AI åŠ©æ‰‹ä¹‹é—´çš„ç©ºç™½ï¼Œè®©é‚®ä»¶æˆä¸º AI å·¥ä½œæµä¸­çš„ç¬¬ä¸€å…¬æ°‘ã€‚

## âœ¨ ç‰¹æ€§

- **ğŸ“§ ç›´æ¥é‚®ä»¶è®¿é—®** - AI é€šè¿‡ MCP åè®®ç›´æ¥è¯»å–ä½ çš„é‚®ä»¶
- **ğŸ§µ çº¿ç´¢æ”¯æŒ** - ä¸€ä¸ª Message-ID è·å–å®Œæ•´çš„é‚®ä»¶å¯¹è¯
- **ğŸ” å¿«é€Ÿé«˜æ•ˆ** - æ¯«ç§’çº§æŸ¥è¯¢é€Ÿåº¦
- **ğŸ¯ çº¯æ–‡æœ¬è¾“å‡º** - å¹²å‡€çš„æ–‡æœ¬æå–ï¼Œä¸“ä¸º AI åˆ†æä¼˜åŒ–
- **âš¡ æ˜“äºä½¿ç”¨** - Mail åº”ç”¨ä¸­çš„ Quick Actionï¼ˆâŒ˜â‡§C å¤åˆ¶ Message-IDï¼‰
- **ğŸ”’ éšç§ä¼˜å…ˆ** - æœ¬åœ°è¿è¡Œï¼Œé‚®ä»¶æ°¸ä¸ç¦»å¼€ä½ çš„ Mac

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å‰ç½®è¦æ±‚

- macOS 12.0+ï¼ˆå¸¦ Mail åº”ç”¨ï¼‰
- Python 3.9+
- MCP å…¼å®¹çš„ AI åŠ©æ‰‹ï¼ˆå¦‚ Claude Desktopï¼‰

### å®‰è£…

```bash
# å…‹éš†ä»“åº“
git clone https://github.com/fatbobman/mail-mcp-bridge.git
cd mail-mcp-bridge

# è¿è¡Œå®‰è£…è„šæœ¬
./setup_mcp.sh
```

å®‰è£…è„šæœ¬ä¼šï¼š
1. æ£€æŸ¥ Python ç¯å¢ƒ
2. å®‰è£… MCP ä¾èµ–
3. ä¸º Claude Desktop é…ç½® MCP æœåŠ¡å™¨
4. æ¸…ç† Python ç¼“å­˜

> **æ³¨æ„ï¼š** æœ¬é¡¹ç›®å·²åœ¨ macOS 26 (Tahoe) ä¸Šæµ‹è¯•ã€‚ç†è®ºä¸Šæ”¯æŒ macOS 12.0+ï¼Œä½†å…¶ä»–ç‰ˆæœ¬æœªç»æµ‹è¯•ã€‚

### è®¾ç½® Mail Quick Action

æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤ä¸º Mail æ·»åŠ "å¤åˆ¶ Message-ID"åŠŸèƒ½ï¼š

1. **æ‰“å¼€ Automator**
   - æŒ‰ `âŒ˜ + Space` å¹¶è¾“å…¥"Automator"
   - æˆ–åœ¨ `/Applications/Automator.app` ä¸­æ‰¾åˆ°

2. **åˆ›å»ºæ–°çš„ Quick Action**
   - File â†’ Newï¼ˆæˆ– `âŒ˜ + N`ï¼‰
   - é€‰æ‹©"Quick Action"ï¼ˆæ—§ç‰ˆ macOS å¯èƒ½æ˜¾ç¤ºä¸º"Service"ï¼‰
   - ç‚¹å‡»"Choose"

3. **é…ç½® Quick Action**
   - Workflow receives current: **email messages**
   - in: **Mail.app**
   - å‹¾é€‰ï¼š"Output replaces selected text"

4. **æ·»åŠ  Shell Script Action**
   - åœ¨å·¦ä¾§é¢æ¿æœç´¢"Run Shell Script"
   - æ‹–æ‹½åˆ°å·¥ä½œæµåŒºåŸŸ
   - Shell: `/bin/bash`
   - Pass input: **as arguments**

5. **å¤åˆ¶è„šæœ¬å†…å®¹**
   ```bash
   cat automator_script.sh
   ```
   - å¤åˆ¶å…¨éƒ¨è¾“å‡º
   - ç²˜è´´åˆ° Automator çš„è„šæœ¬åŒºåŸŸ

6. **ä¿å­˜ Quick Action**
   - File â†’ Saveï¼ˆæˆ– `âŒ˜ + S`ï¼‰
   - åç§°ï¼š**Copy Message-ID**
   - ä¼šä¿å­˜åˆ° `~/Library/Services/`

7. **åˆ†é…å¿«æ·é”®**ï¼ˆæ¨èï¼‰
   - ç³»ç»Ÿè®¾ç½® â†’ é”®ç›˜ â†’ é”®ç›˜å¿«æ·é”®
   - é€‰æ‹©ï¼šServices â†’ Mail
   - æ‰¾åˆ°ï¼š"Copy Message-ID"
   - ç‚¹å‡»å¹¶æ·»åŠ å¿«æ·é”®ï¼š`âŒ˜ + â‡§ + C`

**è®¾ç½®é¢„è§ˆï¼š**

![Automator Setup](images/automatic-setup.webp)

**æµ‹è¯•ä¸€ä¸‹ï¼š**
1. æ‰“å¼€ Mail åº”ç”¨
2. é€‰æ‹©ä»»æ„é‚®ä»¶
3. æŒ‰ `âŒ˜ + â‡§ + C`
4. ä¼šå¬åˆ°æç¤ºéŸ³å¹¶çœ‹åˆ°å¸¦æœ‰ Message-ID çš„é€šçŸ¥
5. Message-ID å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼Œå¯ä»¥ç²˜è´´ç»™ AI äº†

## ğŸ“– ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬å·¥ä½œæµ

1. åœ¨ Mail ä¸­**é€‰æ‹©é‚®ä»¶**
2. æŒ‰ **âŒ˜â‡§C**ï¼ˆæˆ–å³é”® â†’ Copy Message-IDï¼‰
3. å°† Message-ID **ç²˜è´´ç»™ AI**

### ä½¿ç”¨ç¤ºä¾‹

**è¯»å–å•å°é‚®ä»¶ï¼š**
```
ä½ ï¼šè¯·åˆ†æè¿™å°é‚®ä»¶ï¼š<message-id@example.com>

AIï¼šæˆ‘æ¥å¸®ä½ åˆ†æè¿™å°é‚®ä»¶...
[AI è¯»å–å¹¶åˆ†æé‚®ä»¶å†…å®¹]
```

**è¯»å–é‚®ä»¶çº¿ç´¢ï¼š**
```
ä½ ï¼šè¿™ä¸ª Message-ID å¯¹åº”çš„å®Œæ•´å¯¹è¯æ˜¯ä»€ä¹ˆï¼Ÿ

AIï¼šæˆ‘æ¥è·å–æ•´ä¸ªé‚®ä»¶çº¿ç´¢...
[AI æ˜¾ç¤ºå¯¹è¯ä¸­çš„æ‰€æœ‰é‚®ä»¶]
```

**å…¸å‹åº”ç”¨åœºæ™¯ï¼š**

```
ä½ ï¼šå¸®æˆ‘æ€»ç»“ä¸€ä¸‹ä¸èµåŠ©å•† Proxyman çš„æ‰€æœ‰é‚®ä»¶æ²Ÿé€šï¼Œ
åŒ…æ‹¬ä»–ä»¬çš„éœ€æ±‚ã€æ‰¿è¯ºçš„æ—¶é—´ç‚¹å’Œå¾…åŠäº‹é¡¹ã€‚

AIï¼šæˆ‘ä¼šè¯»å–ç›¸å…³é‚®ä»¶çº¿ç´¢å¹¶æå–å…³é”®ä¿¡æ¯...
[AI åˆ†æé‚®ä»¶å†…å®¹ï¼Œæ•´ç†å‡ºé¡¹ç›®è¿›å±•ã€æ‰¿è¯ºå’Œè¡ŒåŠ¨é¡¹]
```

## ğŸ› ï¸ MCP å·¥å…·

MCP æœåŠ¡å™¨æä¾› 4 ä¸ªå·¥å…·ï¼š

### 1. `get_email_path`
é€šè¿‡ Message-ID è·å–å•ä¸ªé‚®ä»¶çš„æ–‡ä»¶è·¯å¾„ã€‚

**å‚æ•°ï¼š**
- `message_id` (string) - RFC Message-IDï¼Œå¦‚ `<abc@example.com>`

**è¿”å›ï¼š**
```json
{
  "success": true,
  "file_path": "/path/to/email.emlx"
}
```

### 2. `get_thread_paths`
è·å–é‚®ä»¶çº¿ç´¢ä¸­æ‰€æœ‰é‚®ä»¶çš„æ–‡ä»¶è·¯å¾„ã€‚

**å‚æ•°ï¼š**
- `message_id` (string) - çº¿ç´¢ä¸­ä»»æ„é‚®ä»¶çš„ Message-ID

**è¿”å›ï¼š**
```json
{
  "success": true,
  "thread_size": 3,
  "file_paths": [
    "/path/to/email1.emlx",
    "/path/to/email2.emlx",
    "/path/to/email3.emlx"
  ]
}
```

### 3. `read_email`
è§£æå¹¶è¯»å–å•ä¸ªé‚®ä»¶çš„çº¯æ–‡æœ¬å†…å®¹ã€‚

**å‚æ•°ï¼š**
- `message_id` (string) - RFC Message-ID

**è¿”å›ï¼š**
```json
{
  "success": true,
  "subject": "é‚®ä»¶ä¸»é¢˜",
  "from": "å‘ä»¶äºº <sender@example.com>",
  "to": "æ”¶ä»¶äºº <recipient@example.com>",
  "date": "æ—¥æœŸå­—ç¬¦ä¸²",
  "body_text": "çº¯æ–‡æœ¬é‚®ä»¶æ­£æ–‡",
  "headers": {...}
}
```

### 4. `read_thread`
è§£æå¹¶è¯»å–æ•´ä¸ªé‚®ä»¶çº¿ç´¢ã€‚

**å‚æ•°ï¼š**
- `message_id` (string) - çº¿ç´¢ä¸­ä»»æ„é‚®ä»¶çš„ Message-ID

**è¿”å›ï¼š**
```json
{
  "success": true,
  "thread_size": 3,
  "emails": [
    {/* é‚®ä»¶ 1 */},
    {/* é‚®ä»¶ 2 */},
    {/* é‚®ä»¶ 3 */}
  ]
}
```

## ğŸ—ï¸ å·¥ä½œåŸç†

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Mail App   â”‚ é€‰æ‹©é‚®ä»¶ â†’ å¤åˆ¶ Message-ID (âŒ˜â‡§C)
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“ Message-ID
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚MCP Server   â”‚ 1. æŸ¥è¯¢ Mail SQLite æ•°æ®åº“
â”‚             â”‚ 2. é€šè¿‡ ROWID å®šä½ .emlx æ–‡ä»¶
â”‚             â”‚ 3. è§£æé‚®ä»¶å†…å®¹
â”‚             â”‚ 4. æå–çº¯æ–‡æœ¬
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“ ç»“æ„åŒ–æ•°æ®
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AI Assistantâ”‚ åˆ†æé‚®ä»¶å†…å®¹ã€æå–ä¿¡æ¯ã€è·Ÿè¸ªè¿›å±•
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æŠ€æœ¯ç»†èŠ‚

- **Mail æ•°æ®åº“**: `~/Library/Mail/V10/MailData/Envelope Index` (SQLite)
- **é‚®ä»¶å­˜å‚¨**: `~/Library/Mail/V10/{Account}/{Mailbox}.mbox/.../{ROWID}.emlx`
- **å…³é”®å‘ç°**: `messages.ROWID` = æ–‡ä»¶åï¼ˆä¸æ˜¯ `remote_id`ï¼ï¼‰

## ğŸ“ é¡¹ç›®ç»“æ„

```
mail-mcp-bridge/
â”œâ”€â”€ get_email_path.py       # è·å–å•ä¸ªé‚®ä»¶æ–‡ä»¶è·¯å¾„
â”œâ”€â”€ get_thread_paths.py      # è·å–é‚®ä»¶çº¿ç´¢è·¯å¾„
â”œâ”€â”€ parse_email.py           # è§£æ .emlx ä¸ºçº¯æ–‡æœ¬
â”œâ”€â”€ mail_mcp_server.py       # MCP æœåŠ¡å™¨ï¼ˆä¸»ç¨‹åºï¼‰
â”œâ”€â”€ setup_mcp.sh             # å®‰è£…è„šæœ¬
â”œâ”€â”€ automator_script.sh      # Mail Quick Action è„šæœ¬
â””â”€â”€ README.md                # è‹±æ–‡æ–‡æ¡£
```

## âš™ï¸ é…ç½®

### MCP æœåŠ¡å™¨é…ç½®

è¿è¡Œ `setup_mcp.sh` åï¼ŒMCP æœåŠ¡å™¨é…ç½®åœ¨ï¼š
```
~/.claude.json
```

é…ç½®å†…å®¹ï¼š
```json
{
  "mcpServers": {
    "mail": {
      "command": "python3",
      "args": [
        "/path/to/mail-mcp-bridge/mail_mcp_server.py"
      ]
    }
  }
}
```

## ğŸ› æ•…éšœæ’é™¤

### é—®é¢˜ï¼šMCP æœåŠ¡å™¨æœªæ‰¾åˆ°
**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# é‡æ–°è¿è¡Œå®‰è£…
./setup_mcp.sh

# é‡å¯ Claude Desktop
```

### é—®é¢˜ï¼šæœªæ‰¾åˆ°é‚®ä»¶
**å¯èƒ½åŸå› ï¼š**
1. Message-ID æ ¼å¼ä¸æ­£ç¡®ï¼ˆå¿…é¡»åŒ…å« `< >`ï¼‰
2. é‚®ä»¶å·²ä» Mail ä¸­åˆ é™¤
3. é‚®ä»¶åœ¨ä¸åŒ Mail è´¦æˆ·çš„æ•°æ®åº“ä¸­

### é—®é¢˜ï¼šæƒé™è¢«æ‹’ç»
**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# æ·»åŠ æ‰§è¡Œæƒé™
chmod +x *.py *.sh
```

## ğŸ”’ éšç§ä¸å®‰å…¨

- âœ… **æœ¬åœ°å¤„ç†**ï¼šæ‰€æœ‰æ“ä½œåœ¨æœ¬åœ° Mac ä¸Šè¿è¡Œ
- âœ… **æ— å¤–éƒ¨æœåŠ¡å™¨**ï¼šä¸å‘é€æ•°æ®åˆ°å¤–éƒ¨æœåŠ¡å™¨
- âœ… **æ— é¥æµ‹**ï¼šæ— åˆ†ææˆ–è·Ÿè¸ª
- âœ… **åªè¯»**ï¼šåªè¯»å–é‚®ä»¶æ•°æ®ï¼Œæ°¸ä¸ä¿®æ”¹
- âœ… **Apple Silicon åŸç”Ÿ**ï¼šé’ˆå¯¹ Apple Silicon Mac ä¼˜åŒ–

## ğŸ“ è®¸å¯è¯

MIT License - è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶ã€‚

## ğŸ¤ è´¡çŒ®

æ¬¢è¿è´¡çŒ®ï¼è¯·éšæ—¶æäº¤ Pull Requestã€‚

## ğŸŒŸ è‡´è°¢

- ä¸º MCP (Model Context Protocol) ç”Ÿæ€ç³»ç»Ÿæ„å»º
- çµæ„Ÿæ¥æºäºè¿æ¥é‚®ä»¶å’Œ AI çš„éœ€æ±‚
- åœ¨ macOS 15.0+ ä¸Šçš„ Claude Desktop ä¸­æµ‹è¯•

## ğŸ“® è”ç³»æ–¹å¼

- **Issues**: https://github.com/fatbobman/mail-mcp-bridge/issues
- **ä½œè€…**: Fatbobman (å¾é˜³)

---

**ç”¨ â¤ï¸ ä¸º AI ç¤¾åŒºæ‰“é€ **
